---
title: Fyrirlestur ‚Äì Hlutir
---

# Fyrirlestur ‚Äì Hlutir

## Vefforritun 1 ‚Äî T√ñL107G

### √ìlafur Sverrir Kjartansson, [osk@hi.is](mailto:osk@hi.is)

---

## Hlutir og hj√∫pun

* Objects & [encapsulation](https://en.wikipedia.org/wiki/Encapsulation_(computer_programming))
* Ein af a√∞al hugmyndum hlutbundinnar forritunar er a√∞ skipta forritum upp og l√°ta hvern hluta bera √°byrg√∞ √° eigin st√∂√∞u
* Hj√∫pum virkni og fl√¶kjustig, vinnum me√∞ √≠ gegnum _interface_

***

## Methods

* Method er fall √° hlut
* Hva√∞ ef vi√∞ viljum n√°lgast g√∂gn √° hlutnum √∫r falli?
* Notum `this`

***

## `this`

* [`this`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/this) hagar s√©r √∂√∞ruv√≠si √≠ JavaScript en √≠ √∂√∞rum m√°lum
* Skilgreinist af √æv√≠ hvernig kalla√∞ er √≠ falli√∞
* Utan hluta er `this` global hluturinn, √æ.e. √æar sem allt er geymt (√≠ browser `window`)

***

```javascript
function logThis() { console.log(this); }
const Obj = {
  logThis() { console.log(this); },
};
const btn = document.querySelector('button');
btn.addEventListener('click', logThis);

console.log(this); // window
logThis(); // window
Obj.logThis(); // {logThis: f}
btn.click(); // <button>
```

***

* [`this` d√¶mi](./daemi/01.this.html)

***

```javascript
const rabbit = {
  type: 'the',
};
rabbit.speak = (line) => {
  console.log(
    `${this.type} rabbit says '${line}'`
  );
};

rabbit.speak('I‚Äôm alive.');
// ‚Üí undefined rabbit says 'I‚Äôm alive.'
```

***

```javascript
const rabbit = {
  type: 'the',
  speak(line) {
    console.log(
      `${this.type} rabbit says '${line}'`
    );
  }
};

rabbit.speak('I‚Äôm alive.');
// ‚Üí the rabbit says 'I‚Äôm alive.'
```

***

## Apply & call

* Leyfir okkur a√∞ kalla √≠ f√∂ll me√∞ √°kve√∞nu `this`
* `apply` ‚Äì k√∂llum √≠ fall me√∞ gefnu `this` og _fylki_ af arguments
* `call` ‚Äì k√∂llum √≠ fall me√∞ gefnu `this` og _lista_ af arguments

***

<!-- eslint-disable comma-dangle -->

```javascript
function speak(line) {
  console.log(
    `${this.type} rabbit says ${line}`
  );
}
//  festum falli√∞ √° hlutinn üëá
const old = { type: 'old', speak };
const hungy = { type: 'hungry', speak };

old.speak('Oh my');
// old rabbit says Oh my
hungy.speak('I could use a carrot');
// hungry rabbit says I could use a carrot
```

***

<!-- eslint-disable comma-dangle -->

```javascript
function speak(line) {
  console.log(
    `${this.type} rabbit says ${line}`
  );
}

const old = { type: 'old' };

//    üëá  k√∂llum √≠ falli√∞ _me√∞_ hlutnum
speak.apply(old, ['Oh my']);
// old rabbit says Oh my
speak.call({ type: 'hungry' }, 'Yum');
// hungry rabbit says Yum
```

***

## Bind

* Leyfir okkur a√∞ festa, _binda_, `this` fyrir f√∂ll
* Kemur okkur ekki √° √≥vart hva√∞ `this` er
* Getum l√≠ka bundi√∞ argument...

***

## Bind ‚Äì d√¶mi

<!-- eslint-disable comma-dangle -->

```javascript
function speak(line) {
  console.log(
    `${this.type} rabbit says ${line}`
  );
}
const blueRabbit = { type: 'blue' };

// bindum fall v/hlut üëá f√°um n√Ωtt fall!
const bound = speak.bind(blueRabbit);
bound('hi'); // blue rabbit says hi
```

<!-- eslint-disable no-undef -->

```javascript
// Getum kalla√∞ strax √≠ fall üëá
speak.bind(blueRabbit, 'bye')();
// blue rabbit says bye
```

***

## Arrow f√∂ll

* Arrow f√∂ll eru √∂√∞ruv√≠si‚Äîendurskilgreina ekki `this`
* `this` er skilgreint eins og √æa√∞ var skilgreint √≠ scope kringum fall

***

```javascript
function normalize() {
  function inner(n) {
    //          üëá v√≠sar √≠ window! üôÄ
    return n / this.length;
  }
  //           üëá v√≠sar √≠ ‚Äûr√©ttan‚Äú hlut ü•¥
  console.log(this.coords.map(inner));
}

const o = { coords: [0, 2, 3], length: 5 };

normalize.call(o);
// ‚Üí [NaN, Infinity, Infinity]
```

***

<!-- eslint-disable comma-dangle -->

```javascript
function normalize() {
  console.log(
    // üëá v√≠sar √≠ r√©ttan hlut
    this.coords.map(
      //        üëá v√≠sar √≠ r√©ttan hlut
      n => n / this.length
    )
  );
}

const o = { coords: [0, 2, 3], length: 5 };

normalize.call(o);
// ‚Üí [0, 0.4, 0.6]
```

***

```javascript
function normalize() {
  const inner = (n) => {
    //          üëá v√≠sar √≠ r√©ttan hlut üòä
    return n / this.length;
  }
  console.log(this.coords.map(inner));
}

const o = { coords: [0, 2, 3], length: 5 };

normalize.call(o);
// ‚Üí [0, 0.4, 0.6]
```

---

## Pr√≥t√≥t√Ωpur

* [Flestir hlutir hafa _pr√≥t√≥t√Ωpu_](https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/Object_prototypes), hlutur sem geymir fleiri properties
  * Fyrir utan `null` og `undefined`
* Ef vi√∞ bi√∞jum um property √° hlut sem er ekki skilgreint √° hlut er leita√∞ √° pr√≥t√≥t√Ωpu hans

***

* √ç grunninn h√∂fum vi√∞ `Object`
  * E√∞a n√°nar tilteki√∞ `Object.prototype`
* `Object.getPrototypeOf()` skilar _hva√∞a_ pr√≥t√≥t√Ωpu gildi hefur

***

```javascript
const empty = {};
console.log(empty.toString);
// ‚Üí function toString() { ‚Ä¶ }
console.log(empty.toString());
// ‚Üí [object Object]
```

```javascript
console.log(1.toString()); // ‚Üí "1"
```

```javascript
console.log(NaN.toString()); // ‚Üí "NaN"
```

```javascript
console.log(null.toString());
// ‚Üí TypeError: null has no properties
```

***

## A√∞rar pr√≥t√≥t√Ωpur

* A√∞rir hlutir hafa a√∞rar pr√≥t√≥t√Ωpur
  * `[]` hefur `Array.prototype`
  * F√∂ll hafa `Function.prototype`
* √ûessar pr√≥t√≥t√Ωpur hafa s√≠nar eigin pr√≥t√≥t√Ωpur!
  * Mynda [pr√≥t√≥t√Ωpu ke√∞ju](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Inheritance_and_the_prototype_chain)

***

<!-- eslint-disable comma-dangle -->

```javascript
const empty = Object.getPrototypeOf({});
console.log(
  empty === Object.prototype
);
// ‚Üí true
```

<!-- eslint-disable comma-dangle -->

```javascript
console.log(
  Object.getPrototypeOf(Object.prototype)
);
// ‚Üí null
```

***

<!-- eslint-disable comma-dangle -->

```javascript
const funcProto = Object.getPrototypeOf(
  Math.max
);

console.log(
  funcProto === Function.prototype
);
// ‚Üí true
```

<!-- eslint-disable -->

```javascript
console.log(
  Object.getPrototypeOf(funcProto) ===
    Object.prototype
);
// ‚Üí true
```

***

<!-- eslint-disable operator-linebreak, comma-dangle -->

```javascript
const array = Object.getPrototypeOf([]);

console.log(
  array === Array.prototype
);
// ‚Üí true
```

***

<!-- eslint-disable operator-linebreak, comma-dangle -->

```javascript
const objProto = Object.getPrototypeOf({});
console.log(
  Object.getPrototypeOf(objProto)
);
// ‚Üí null
// ke√∞jan endar √° Object prototype!
```

***

## Pr√≥t√≥t√Ωpu ke√∞jan

* Hlutir f√° eigindi fr√° pr√≥t√≥t√Ωpunni en eigindi √° hlutnum hafa aldrei √°hrif √° ke√∞juna
  * Getum ekki skrifa√∞ yfir hluti √° pr√≥t√≥t√Ωpu
* A√∞ setja eigindi √° hlut setur √æa√∞ alltaf √° honum sj√°lfum

***

* Ef vi√∞ bi√∞jum um eigindi √° hlut er reglan:
  * Ef skilgreint beint √° hlut er √æv√≠ skila√∞
  * Ef ekki f√∂rum vi√∞ upp pr√≥t√≥t√Ωpu ke√∞juna og leitum √æar
  * Ef finnst hvergi er `undefined` skila√∞

***

## Hlutir me√∞ √°kve√∞na pr√≥t√≥t√Ωpu

* `Object.create()` b√Ωr til hlut me√∞ √°kve√∞inni pr√≥t√≥t√Ωpu
* Lei√∞ til a√∞ h√≥pa saman f√∂llum
* Pr√≥t√≥t√Ωpan geymir sameiginlegu f√∂llin

***

<!-- eslint-disable comma-dangle -->

```javascript
const protoRabbit = {
  speak(line) {
    console.log(
      `${this.type} rabbit says '${line}'`
    );
  }
};
const killer = Object.create(protoRabbit);
```

```javascript
killer.type = 'killer';
//    üëá speak fall kemur fr√° prototype
killer.speak('SKREEEE!');
// ‚Üí killer rabbit says 'SKREEEE!'
```

***

## Klasar (classes)

* √ç JavaScript h√∂fum vi√∞ ekki klasa eins og √≠ klass√≠skum hlutbundnum m√°lum
* Notum pr√≥t√≥t√Ωpu til a√∞ erfa fr√° √∂√∞rum hlutum

***

* √ç klass√≠skum erf√∞um
  * Hlutir eru tilvik af kl√∂sum
  * Klasar erfa fr√° √∂√∞rum kl√∂sum
* Me√∞ pr√≥t√≥t√Ωpum
  * Engir klasar
  * Hlutir erfa fr√° √∂√∞rum hlutum

***

## Smi√∞ir og new

* √ç JavaScript eru smi√∞ir f√∂ll, sk√Ωr√∞ me√∞ st√≥rum staf (hef√∞, ekki krafa)
* √ûegar vi√∞ notum `new` og tilgreinum fall b√∫um vi√∞ til n√Ωjan hlut √æar sem `this` bendir √° hlutinn
* Skilar sj√°lfkrafa `this` sem hlut vegna `new` ef engu er skila√∞
* B√¶tum vi√∞ pr√≥t√≥t√Ωpu til a√∞ b√¶ta vi√∞ sameiginlegum f√∂llum

***

<!-- eslint-disable comma-dangle, func-names -->

```javascript
function Rabbit(type) {
  this.type = type;
}
Rabbit.prototype.speak = function (line) {
  console.log(
    `The ${this.type} rabbit says ${line}`
  );
};
```

<!-- eslint-disable no-undef -->

```javascript
const weirdRabbit = new Rabbit('weird');
console.log(weirdRabbit);
// Rabbit {type: "weird"}
weirdRabbit.speak('üê∞');
// The weird rabbit says 'üê∞'
```

***

## Yfirskrifu√∞ eigindi

* A√∞ setja eigindi √° hlut setur √æa√∞ alltaf √° honum sj√°lfum
* Getum n√Ωtt til a√∞ yfirskrifa eigindi fr√° pr√≥t√≥t√Ωpu
  * T.d. `toString()` til a√∞ skila s√©rt√¶ku gildi fyrir okkar hlut

***

<!-- eslint-disable no-undef -->

```javascript
Rabbit.prototype.teeth = 'small';
const killerRabbit = new Rabbit('killer');
console.log(killerRabbit.teeth);
// ‚Üí small
```

<!-- eslint-disable no-undef -->

```javascript
killerRabbit.teeth = 'long, sharp, bloody';
console.log(killerRabbit.teeth);
// ‚Üí long, sharp, and bloody
```

***

![Erf√∞ir √° rabbits](img/rabbits.svg "Erf√∞ir √° rabbits")

***

<!-- eslint-disable func-names -->

```javascript
function Rabbit(type) {
  this.type = type;
}

const fooRabbit = new Rabbit('foo');
console.log(fooRabbit.toString());
// "[object Object]"

Rabbit.prototype.toString = function () {
  return `Rabbit of type ${this.type}`;
};

console.log(fooRabbit.toString());
// "Rabbit of type foo"
```

---

## Classes

* √ç ECMAScript 6 er [`class`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes) skilgreint
* _Syntactic sugar_ til a√∞ herma eftir klass√≠skum OO hlutum me√∞ pr√≥t√≥t√Ωpum
  * Undirliggjandi skilgreining notar √°fram pr√≥t√≥t√Ωpur
* `extends`, `constructor`, `super`, `static` og getters og setters

***

<!-- eslint-disable no-unused-vars, lines-between-class-members, comma-dangle -->

```javascript
class Rabbit {
  constructor(type) {
    this.type = type;
  }
  speak(line) {
    console.log(
      `${this.type} rabbit says '${line}'`
    );
  }
  toString() {
    return `Rabbit of type ${this.type}`;
  }
}

const killerRabbit = new Rabbit('killer');
```

***

<!-- eslint-disable -->

```javascript
class Foo {
  constructor(name) {
    this._name = name;
  }

  hi() { return 'hi!'; }

  static bar() { return 1; }

  get name() { return this._name; }

  set name(value) { this._name = value; }
}
```

***

<!-- eslint-disable no-undef, no-unused-expressions-->

```javascript
const foo = new Foo('Asdf');
foo.hi(); // "hi!"
foo.name = 'bar';
foo.name; // "bar"

Foo.bar(); // 1
```
